# 应用配置
APP_NAME=GustoBot
APP_VERSION=0.1.0
DEBUG=True

# API配置
API_V1_PREFIX=/api/v1
HOST=0.0.0.0
PORT=8000


# LLM 服务配置(用于文本生成和问答)
LLM_PROVIDER=openai
LLM_MODEL=qwen3-max
LLM_API_KEY=sk-9a1262ef1b7144eab84725635a01ac3d
LLM_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1


# 视觉模型配置（用于图像分析）
VISION_API_KEY=5b2faea76a0543f5b2a2869762a56de0.5NL1lHlmhfFwGqg8
VISION_BASE_URL=https://open.bigmodel.cn/api/paas/v4/chat/completions
VISION_MODEL=glm-4.6

# 图像生成模型配置（用于生成图片）
IMAGE_GENERATION_API_KEY=5b2faea76a0543f5b2a2869762a56de0.5NL1lHlmhfFwGqg8
IMAGE_GENERATION_BASE_URL=https://open.bigmodel.cn/api/paas/v4
IMAGE_GENERATION_MODEL=cogView-4-250304
IMAGE_GENERATION_SIZE=1024x1024

# Milvus向量数据库配置
MILVUS_HOST=milvus
MILVUS_PORT=19530
MILVUS_COLLECTION=recipes
MILVUS_INDEX_TYPE=IVF_FLAT
MILVUS_METRIC_TYPE=IP

# Embedding 服务配置(用于向量生成)
EMBEDDING_PROVIDER=openai
EMBEDDING_MODEL=text-embedding-v4
EMBEDDING_API_KEY=sk-9a1262ef1b7144eab84725635a01ac3d
EMBEDDING_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
EMBEDDING_DIMENSION=1024

# Reranker 服务配置(用于精排)
RERANK_ENABLED=true
RERANK_PROVIDER=custom
RERANK_BASE_URL=https://dashscope.aliyuncs.com/api/v1/services
RERANK_ENDPOINT=/rerank/text-rerank/text-rerank
RERANK_MODEL=qwen3-rerank
RERANK_API_KEY=sk-9a1262ef1b7144eab84725635a01ac3d
RERANK_MAX_CANDIDATES=20
RERANK_TOP_N=6
RERANK_TIMEOUT=30
RERANK_SCORE_FUSION_ALPHA=0.5

# Redis配置
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_URL=redis://redis:6379/0
REDIS_CACHE_EXPIRE=43200
REDIS_CACHE_THRESHOLD=0.92
REDIS_CACHE_MAX_SIZE=1000

# LightRAG配置
LIGHTRAG_WORKING_DIR=./data/lightrag
LIGHTRAG_RETRIEVAL_MODE=hybrid
LIGHTRAG_TOP_K=10
LIGHTRAG_MAX_TOKEN_SIZE=4096
LIGHTRAG_ENABLE_NEO4J=True
LIGHTRAG_ENABLE_MILVUS=False
# LightRAG 容器启动时自动复制内置模板数据（首次挂载卷为空时）
AUTO_BOOTSTRAP_LIGHTRAG=true

# LightRAG 构建时初始化配置（Docker）
INIT_LIGHTRAG_ON_BUILD=true
# LIGHTRAG_INIT_LIMIT=10  #限制初始化的菜谱数量，注释则使用全部

# 数据库配置
# DATABASE_URL=sqlite:///./data/gustobot.db  # 已废弃，使用 MySQL
DATABASE_URL=mysql+pymysql://recipe_user:recipepass@mysql:3306/recipe_db

# Neo4j 配置
NEO4J_URI=bolt://neo4j:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=recipepass
NEO4J_DEFAULT_GRAPH_QUERY=MATCH (a)-[r]-(b) RETURN a, r, b LIMIT 100

# Agent配置
MAX_ITERATIONS=10
AGENT_TIMEOUT=300
# Agent对话记忆保留的用户轮数（正整数；小于等于0表示保留全部历史）
GUSTOBOT_MEMORY_TURNS=5

# 知识库配置
#  - KB_TOP_K:                       每次召回的候选数量
#  - KB_SIMILARITY_THRESHOLD:        召回阶段的最低相似度（Milvus 粗筛，最终由 rerank 决定）
#  - KB_POSTGRES_SIMILARITY_THRESHOLD: Postgres 结果 rerank 后保留的最低相似度
#  - KB_POSTGRES_RERANK_THRESHOLD:     Postgres 结果 rerank 后保留的最低得分
#  - KB_RERANK_SCORE_THRESHOLD:        向量检索结果 rerank 后保留的最低得分
#  - KB_CHUNK_SIZE/OVERLAP:           文本切分长度与重叠
#  - KB_LLM_* / KB_EMBEDDING_*:       kb_ingest 服务使用的 LLM 与嵌入模型配置
#  - KB_RERANK_*:                     kb_ingest rerank 的参数
# KB_TOP_K: KB 最终返回的候选数量
KB_TOP_K=5
# KB_SIMILARITY_THRESHOLD: Milvus 粗召回阶段的最低相似度
KB_SIMILARITY_THRESHOLD=0.2
# KB_POSTGRES_SIMILARITY_THRESHOLD: PostgreSQL 结果的最小相似度
KB_POSTGRES_SIMILARITY_THRESHOLD=0.5
# KB_POSTGRES_RERANK_THRESHOLD: PostgreSQL 结果 rerank 得分阈值
KB_POSTGRES_RERANK_THRESHOLD=0.8
# KB_RERANK_SCORE_THRESHOLD: Milvus 结果 rerank 得分阈值
KB_RERANK_SCORE_THRESHOLD=0.8
# KB_CHUNK_SIZE: 文本切分长度
KB_CHUNK_SIZE=512
# KB_CHUNK_OVERLAP: 文本切分重叠长度
KB_CHUNK_OVERLAP=80
# KB_LLM_PROVIDER: kb_ingest 使用的生成模型供应商
KB_LLM_PROVIDER=openai
# KB_LLM_MODEL: kb_ingest 调用的生成模型名称
KB_LLM_MODEL=qwen3-max
# KB_LLM_API_KEY: kb_ingest 调用 LLM 的 API Key
KB_LLM_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# KB_LLM_BASE_URL: kb_ingest 调用 LLM 的 Base URL
KB_LLM_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
# KB_LLM_TEMPERATURE: kb_ingest 生成时的温度
KB_LLM_TEMPERATURE=0.3
# KB_USE_LLM: 是否启用 LLM 管线
KB_USE_LLM=true
# KB_EMBEDDING_PROVIDER: 嵌入模型供应商
KB_EMBEDDING_PROVIDER=openai
# KB_EMBEDDING_MODEL: 嵌入模型名称
KB_EMBEDDING_MODEL=text-embedding-v4
# KB_EMBEDDING_API_KEY: 嵌入服务 API Key
KB_EMBEDDING_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# KB_EMBEDDING_BASE_URL: 嵌入服务 Base URL
KB_EMBEDDING_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
# KB_EMBEDDING_DIMENSION: 嵌入向量维度
KB_EMBEDDING_DIMENSION=1024
# KB_RERANK_ENABLED: 是否启用 rerank
KB_RERANK_ENABLED=true
# KB_RERANK_PROVIDER: rerank 服务供应商
KB_RERANK_PROVIDER=custom
# KB_RERANK_BASE_URL: rerank 服务 Base URL
KB_RERANK_BASE_URL=https://dashscope.aliyuncs.com/api/v1/services
# KB_RERANK_ENDPOINT: rerank 服务路径
KB_RERANK_ENDPOINT=/rerank/text-rerank/text-rerank
# KB_RERANK_API_KEY: rerank 服务 API Key
KB_RERANK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# KB_RERANK_MODEL: rerank 模型名称
KB_RERANK_MODEL=qwen3-rerank

# 外部数据接入服务
# 设置后，create_query/file_query 会调用该服务的/api/ingest/excel
# http://localhost:8000
INGEST_SERVICE_URL=http://localhost:8000
# Excel导入默认启用增量更新
INGEST_INCREMENTAL_DEFAULT=true

# 本地文件接入的最大体积（MB）
FILE_UPLOAD_MAX_MB=2

# 是否允许联网检索（SerpAPI）
ENABLE_EXTERNAL_SEARCH=false
KB_ENABLE_EXTERNAL_SEARCH=false

# 对话历史配置
CONVERSATION_HISTORY_TTL=259200
CONVERSATION_HISTORY_MAX_MESSAGES=200

# CORS配置（逗号分隔）
CORS_ORIGINS=http://localhost:3000,http://localhost:5173

# Ollama配置
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_EMBEDDING_MODEL=nomic-embed-text
