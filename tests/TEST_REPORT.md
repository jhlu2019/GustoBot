# GustoBot Agent è·¯ç”±æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2025-10-30 02:11:20 - 02:15:42
**æµ‹è¯•ç¯å¢ƒ**: Docker å®¹å™¨ (gustobot_server_1)
**æµ‹è¯•ç”¨ä¾‹æ•°**: 10
**æµ‹è¯•è€—æ—¶**: çº¦ 4.5 åˆ†é’Ÿ

---

## ğŸ“Š æµ‹è¯•æ¦‚è§ˆ

| æŒ‡æ ‡ | ç»“æœ |
|------|------|
| **æ€»è®¡** | 10 |
| **âœ… é€šè¿‡** | 7 (70.0%) |
| **âŒ å¤±è´¥** | 1 (10.0%) |
| **âš ï¸ é”™è¯¯** | 2 (20.0%) |
| **æˆåŠŸç‡** | 70.0% |

---

## ğŸ¯ è¯¦ç»†æµ‹è¯•ç»“æœ

### 1ï¸âƒ£ General-Queryï¼ˆé—²èŠé—®å€™ï¼‰

#### âœ… PASS - åŸºæœ¬é—®å€™
- **é—®é¢˜**: "ä½ å¥½"
- **é¢„æœŸè·¯ç”±**: general-query
- **å®é™…è·¯ç”±**: general-query âœ…
- **å“åº”æ—¶é—´**: 5.00s
- **è·¯ç”±é€»è¾‘**: ç”¨æˆ·ä»…è¿›è¡Œäº†é—®å€™ï¼Œå±äºè½»é‡å¯¹è¯ã€‚
- **å›å¤æ‘˜è¦**:
  ```
  äº²ï½ğŸ‘‹ æ‚¨å¥½å‘€ï¼å¾ˆé«˜å…´è§åˆ°æ‚¨ï½
  æœ‰ä»€ä¹ˆèœè°±ã€é£Ÿææ­é…ã€çƒ¹é¥ªæŠ€å·§æ–¹é¢çš„é—®é¢˜ï¼Œæˆ–è€…æƒ³æ‰¾æŸé“èœçš„åšæ³•å—ï¼Ÿéšæ—¶å‘Šè¯‰æˆ‘å“¦ï¼ğŸ˜ŠğŸ²
  ```
- **âœ… éªŒè¯ç‚¹**:
  - [x] è·¯ç”±ç±»å‹æ­£ç¡®
  - [x] ä½¿ç”¨ç¤¼è²Œç”¨è¯­ï¼ˆ"äº²ï½"ï¼‰
  - [x] åŒ…å« emoji
  - [x] æ— è°ƒç”¨çŸ¥è¯†åº“

---

### 2ï¸âƒ£ Additional-Queryï¼ˆè¡¥å……ä¿¡æ¯ï¼‰

#### âš ï¸ ERROR - æ¨¡ç³Šæé—®
- **é—®é¢˜**: "æˆ‘æƒ³åšèœ"
- **é¢„æœŸè·¯ç”±**: additional-query
- **å®é™…è·¯ç”±**: ERROR âŒ
- **é”™è¯¯ä¿¡æ¯**: `'NoneType' object has no attribute 'decision'`
- **é—®é¢˜åˆ†æ**:
  - Guardrails èŠ‚ç‚¹è¿”å›äº† `None` è€Œä¸æ˜¯ `AdditionalGuardrailsOutput` å¯¹è±¡
  - å¯èƒ½æ˜¯ LLM è¿”å›æ ¼å¼ä¸ç¬¦åˆé¢„æœŸï¼Œå¯¼è‡´ç»“æ„åŒ–è¾“å‡ºå¤±è´¥
- **ä¿®å¤å»ºè®®**:
  ```python
  # åœ¨ lg_builder.py:311 æ·»åŠ ç©ºå€¼æ£€æŸ¥
  guardrails_output = await guardrails_chain.ainvoke(...)
  if guardrails_output is None:
      logger.warning("Guardrails returned None, defaulting to proceed")
      guardrails_output = AdditionalGuardrailsOutput(decision="proceed")
  ```

#### âŒ FAIL - æ— å…³é—®é¢˜ï¼ˆé¢„æœŸ Guardrails æ‹¦æˆªï¼‰
- **é—®é¢˜**: "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·"
- **é¢„æœŸè·¯ç”±**: additional-queryï¼ˆç„¶åè¢« Guardrails æ‹¦æˆªï¼‰
- **å®é™…è·¯ç”±**: general-query âŒ
- **å“åº”æ—¶é—´**: 12.33s
- **è·¯ç”±é€»è¾‘**: ç”¨æˆ·è¯¢é—®çš„æ˜¯å¤©æ°”æƒ…å†µï¼Œä¸èœè°±ã€é£Ÿææˆ–çƒ¹é¥ªæ— å…³ï¼Œå±äºéç›¸å…³è½»é‡å¯¹è¯ã€‚
- **å›å¤æ‘˜è¦**:
  ```
  å¨å‹æ‚¨å¥½ï½æ„Ÿè°¢æ‚¨çš„å’¨è¯¢ï½ğŸ˜Š
  ä¸å¥½æ„æ€å‘¢äº²ï¼Œè¿™ä¸ªé—®é¢˜å¯èƒ½ä¸å¤ªå±äºæˆ‘ä»¬çš„èœè°±èŒƒå›´å•¦ï½
  ...
  æœŸå¾…ç»§ç»­ä¸ºæ‚¨æ•ˆåŠ³ï½
  ```
- **é—®é¢˜åˆ†æ**:
  - LLM åœ¨ç¬¬ä¸€å±‚è·¯ç”±æ—¶å°±åˆ¤æ–­ä¸º `general-query`ï¼Œæ²¡æœ‰è¿›å…¥ `additional-query` â†’ Guardrails æµç¨‹
  - å®é™…ä¸Š LLM çš„åˆ¤æ–­ä¹Ÿåˆç†ï¼šç›´æ¥åœ¨ general-query ä¸­æ‹’ç»
  - è¿™ä¸ç®—ä¸¥æ ¼æ„ä¹‰çš„å¤±è´¥ï¼Œåªæ˜¯è·¯ç”±è·¯å¾„ä¸é¢„æœŸä¸åŒ
- **å»ºè®®**:
  - å¦‚æœéœ€è¦å¼ºåˆ¶èµ° Guardrails æµç¨‹ï¼Œå¯ä»¥è°ƒæ•´ ROUTER_SYSTEM_PROMPT
  - æˆ–è€…æ¥å—è¿™ç§"early rejection"æœºåˆ¶ï¼ˆæ›´é«˜æ•ˆï¼‰

---

### 3ï¸âƒ£ KB-Queryï¼ˆå‘é‡çŸ¥è¯†åº“ï¼‰

#### âœ… PASS - å†å²å…¸æ•…æŸ¥è¯¢
- **é—®é¢˜**: "å®«ä¿é¸¡ä¸çš„å†å²å…¸æ•…æ˜¯ä»€ä¹ˆ"
- **é¢„æœŸè·¯ç”±**: kb-query
- **å®é™…è·¯ç”±**: kb-query âœ…
- **å“åº”æ—¶é—´**: 23.59s
- **è·¯ç”±é€»è¾‘**: ç”¨æˆ·è¯¢é—®å®«ä¿é¸¡ä¸çš„å†å²å…¸æ•…ï¼Œå±äºèœå“èƒŒæ™¯å’Œæ–‡åŒ–çŸ¥è¯†ï¼Œåº”é€šè¿‡çŸ¥è¯†åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯ã€‚
- **KB Multi-tool å­å†³ç­–**:
  - âœ… Guardrails decision: `proceed`
  - âœ… Router decision: `local tools=['milvus']`
  - âœ… Milvus retrieval: Found 18 results
  - â„¹ï¸ æ²¡æœ‰è§¦å‘ Rerankerï¼ˆå•ä¸€æ¥æºï¼‰
- **å›å¤æ‘˜è¦**:
  ```
  å…³äº"å®«ä¿é¸¡ä¸"çš„å†å²å…¸æ•…ï¼Œå½“å‰æä¾›çš„æ£€ç´¢ç»“æœä¸­å¹¶æœªç›´æ¥æåŠè¯¥èœè‚´çš„èµ·æºæˆ–ç›¸å…³æ•…äº‹ã€‚

  ä¸è¿‡ï¼Œç»“åˆå·²æœ‰ä¿¡æ¯å’Œæ™®éçš„å†å²è®¤çŸ¥å¯ä»¥è¯´æ˜ï¼š
  - å®«ä¿é¸¡ä¸æ˜¯ä¸€é“è‘—åçš„å·èœï¼Œå…¶åç§°ä¸­çš„"å®«ä¿"æºè‡ªæ¸…æœå®˜å‘˜ä¸å®æ¡¢çš„å®˜è¡”...
  ```
- **âœ… éªŒè¯ç‚¹**:
  - [x] è·¯ç”±ç±»å‹æ­£ç¡®
  - [x] KB Multi-tool Router æ™ºèƒ½é€‰æ‹©äº† Milvus
  - [x] è¿”å›äº†åˆç†çš„å›ç­”ï¼ˆå³ä½¿çŸ¥è¯†åº“æ²¡æœ‰ç›´æ¥ä¿¡æ¯ï¼Œä¹Ÿç»“åˆå¸¸è¯†è¡¥å……ï¼‰

#### âœ… PASS - åœ°åŸŸæµæ´¾ä»‹ç»
- **é—®é¢˜**: "å·èœçš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆ"
- **é¢„æœŸè·¯ç”±**: kb-query
- **å®é™…è·¯ç”±**: kb-query âœ…
- **å“åº”æ—¶é—´**: 40.96s
- **KB Multi-tool å­å†³ç­–**:
  - âœ… Guardrails decision: `proceed`
  - âœ… Router decision: `local tools=['milvus']`
  - Router é€»è¾‘: "è¯¥é—®é¢˜è¯¢é—®çš„æ˜¯å·èœçš„æ•´ä½“é£å‘³ç‰¹ç‚¹ï¼Œå±äºèœç³»æ¦‚è¿°ç±»é—®é¢˜..."
  - âœ… Milvus retrieval: Found 15 results
- **å›å¤æ‘˜è¦**:
  ```
  å·èœï¼Œå³å››å·èœï¼Œæ˜¯ä¸­å›½å…«å¤§èœç³»ä¹‹ä¸€ï¼Œä»¥å…¶é²œæ˜çš„é£å‘³ç‰¹è‰²è‘—ç§°ã€‚

  ### å·èœçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š
  1. **å‘³å‹ä¸°å¯Œã€å–„ç”¨å¤åˆè°ƒå‘³**
  2. **é‡ç”¨æœ¬åœŸé¦™è¾›æ–™ï¼Œå°¤ä»¥èŠ±æ¤’ä¸ºç‰¹è‰²**
  3. **è¾£æ¤’è™½éåŸäº§ï¼Œä½†æ·±åˆ»å¡‘é€ äº†ç°ä»£å·èœ**
  ...
  ```
- **âœ… éªŒè¯ç‚¹**:
  - [x] è·¯ç”±ç±»å‹æ­£ç¡®
  - [x] KB Router é€‰æ‹©äº† Milvus
  - [x] è¿”å›äº†ç»“æ„åŒ–çš„è¯¦ç»†å›ç­”

---

### 4ï¸âƒ£ GraphRAG-Queryï¼ˆå›¾è°±æ¨ç†ï¼‰

#### âœ… PASS - èœè°±åšæ³•ï¼ˆCypherï¼‰
- **é—®é¢˜**: "çº¢çƒ§è‚‰æ€ä¹ˆåš"
- **é¢„æœŸè·¯ç”±**: graphrag-query
- **å®é™…è·¯ç”±**: graphrag-query âœ…
- **å“åº”æ—¶é—´**: 11.71s
- **è·¯ç”±é€»è¾‘**: ç”¨æˆ·è¯¢é—®çº¢çƒ§è‚‰çš„å…·ä½“åšæ³•ï¼Œå±äºå…·ä½“èœè°±æ“ä½œé—®é¢˜ï¼Œéœ€é€šè¿‡å›¾è°±æˆ–æ•°æ®åº“è·å–è¯¦ç»†æ­¥éª¤ã€é£Ÿæç”¨é‡ç­‰ä¿¡æ¯ã€‚
- **GraphRAG Planner å­å†³ç­–**:
  - âœ… Guardrails å‰ç½®è§„åˆ™å‘½ä¸­èœè°±å…³é”®è¯ï¼Œç›´æ¥è¿›å…¥ planner
  - âœ… Planner åˆ†è§£: "çº¢çƒ§è‚‰çš„è¯¦ç»†åšæ³•æ­¥éª¤æ˜¯ä»€ä¹ˆ"
  - âœ… Tool selection: LLM é€‰æ‹©å·¥å…·ï¼ˆæ¨æµ‹ä¸º cypher_query æˆ– predefined_cypherï¼‰
- **å›å¤æ‘˜è¦**:
  ```
  ### æ•°æ®ç»Ÿè®¡
  çº¢çƒ§è‚‰çš„è¯¦ç»†åšæ³•æ­¥éª¤æ˜¯ä»€ä¹ˆï¼š
  1. å°†äº”èŠ±è‚‰æ¸…æ´—å¹²å‡€åˆ‡æˆæ–¹å½¢çš„å°å—
  2. å°†äº”èŠ±è‚‰å—æ”¾å…¥é”…ä¸­åŠ æ°´ï¼ŒåŠ ä¸€å¤§å‹ºæ–™é…’ï¼Œç…®æ²¸ä¸¤ä¸‰åˆ†é’Ÿ...
  3. å…³ç«åå°†ç…®è‚‰çš„æ°´å€’æ‰ï¼Œå‘é”…ä¸­æ³¨å…¥å‡‰æ°´...
  ...ï¼ˆå…±18ä¸ªæ­¥éª¤ï¼‰
  ```
- **âœ… éªŒè¯ç‚¹**:
  - [x] è·¯ç”±ç±»å‹æ­£ç¡®
  - [x] Planner æ­£ç¡®åˆ†è§£ä»»åŠ¡
  - [x] è¿”å›äº†è¯¦ç»†çš„åˆ†æ­¥éª¤åšæ³•
  - [x] å›å¤æ ¼å¼æ¸…æ™°

#### âœ… PASS - é£ŸææŸ¥è¯¢ï¼ˆCypherï¼‰
- **é—®é¢˜**: "å®«ä¿é¸¡ä¸éœ€è¦å“ªäº›é£Ÿæ"
- **é¢„æœŸè·¯ç”±**: graphrag-query
- **å®é™…è·¯ç”±**: graphrag-query âœ…
- **å“åº”æ—¶é—´**: 13.15s
- **GraphRAG Planner å­å†³ç­–**:
  - âœ… Guardrails å‰ç½®è§„åˆ™å‘½ä¸­
  - âœ… Planner åˆ†è§£: "å®«ä¿é¸¡ä¸çš„ä¸»æ–™ã€è¾…æ–™å’Œè°ƒæ–™åˆ†åˆ«æœ‰å“ªäº›ï¼Ÿ"
  - âœ… Tool selection: LLM é€‰æ‹©å·¥å…·
- **å›å¤æ‘˜è¦**:
  ```
  ### æ•°æ®ç»Ÿè®¡
  å®«ä¿é¸¡ä¸çš„ä¸»æ–™ã€è¾…æ–™å’Œè°ƒæ–™åˆ†åˆ«æœ‰å“ªäº›ï¼Ÿï¼š
  1. ä¸»é£Ÿæï¼šæ·€ç²‰, ç”¨é‡ï¼šé€‚é‡
  2. ä¸»é£Ÿæï¼šèŠ±æ¤’, ç”¨é‡ï¼šé€‚é‡
  3. ä¸»é£Ÿæï¼šå¹²è¾£æ¤’, ç”¨é‡ï¼šé€‚é‡
  ...ï¼ˆå…±8ç§é£Ÿæï¼‰
  ```
- **âœ… éªŒè¯ç‚¹**:
  - [x] è·¯ç”±ç±»å‹æ­£ç¡®
  - [x] Planner ç»†åŒ–äº†é—®é¢˜
  - [x] è¿”å›äº†ç»“æ„åŒ–çš„é£Ÿæåˆ—è¡¨

#### âš ï¸ ERROR - æŠ€å·§æ¨ç†ï¼ˆGraphRAGï¼‰
- **é—®é¢˜**: "æ€ä¹ˆåˆ¤æ–­é±¼ç†Ÿäº†"
- **é¢„æœŸè·¯ç”±**: graphrag-query
- **å®é™…è·¯ç”±**: ERROR âŒ
- **é”™è¯¯ä¿¡æ¯**:
  ```
  2 validation errors for ValidateCypherOutput
  errors: Input should be a valid list [type=list_type, input_value='["é—®é¢˜è¯¢é—®çš„æ˜¯åˆ¤...çš„èŠ‚ç‚¹æˆ–å±æ€§ã€‚"]', input_type=str]
  filters: Input should be a valid list [type=list_type, input_value='[{"node_label": "Ingredi...roperty_value": "é±¼"}]', input_type=str]
  ```
- **é—®é¢˜åˆ†æ**:
  - Planner é€‰æ‹©äº† `cypher_query` å·¥å…·
  - LLM ç”Ÿæˆçš„ Cypher éªŒè¯è¾“å‡ºæ ¼å¼é”™è¯¯ï¼šè¿”å›äº†å­—ç¬¦ä¸²è€Œä¸æ˜¯åˆ—è¡¨
  - LLM æœªç»™å‡ºæ˜ç¡®å·¥å…·ï¼Œå›é€€åˆ° cypher_queryï¼Œä½†æ‰§è¡Œå¤±è´¥
- **ä¿®å¤å»ºè®®**:
  ```python
  # åœ¨ cypher_query èŠ‚ç‚¹ä¸­å¢å¼ºé”™è¯¯å¤„ç†
  try:
      validated_output = ValidateCypherOutput.model_validate(llm_response)
  except ValidationError as e:
      logger.warning(f"Cypher validation failed: {e}, falling back to GraphRAG")
      # é™çº§åˆ° microsoft_graphrag_query å·¥å…·
  ```

---

### 5ï¸âƒ£ Text2SQL-Queryï¼ˆç»Ÿè®¡æŸ¥è¯¢ï¼‰

#### âœ… PASS - ç»Ÿè®¡æŸ¥è¯¢
- **é—®é¢˜**: "æ•°æ®åº“é‡Œæœ‰å¤šå°‘é“èœ"
- **é¢„æœŸè·¯ç”±**: text2sql-query
- **å®é™…è·¯ç”±**: text2sql-query âœ…
- **å“åº”æ—¶é—´**: 24.53s
- **è·¯ç”±é€»è¾‘**: ç”¨æˆ·è¯¢é—®æ•°æ®åº“ä¸­èœè°±çš„æ€»æ•°ï¼Œå±äºå¯¹ç»“æ„åŒ–æ•°æ®çš„ç»Ÿè®¡æŸ¥è¯¢ï¼Œåº”ä½¿ç”¨ text2sql-query ç±»å‹ã€‚
- **Text2SQL å­æµç¨‹**:
  - âœ… Guardrails å‰ç½®è§„åˆ™å‘½ä¸­ç»Ÿè®¡å…³é”®è¯
  - âœ… Planner: "æ•°æ®åº“ä¸­æ”¶å½•çš„èœå“æ€»æ•°æ˜¯å¤šå°‘ï¼Ÿ"
  - âœ… Tool selection: ç›´æ¥è°ƒç”¨ Text2SQL å·¥å…·
  - âœ… Schema retrieval: æ£€ç´¢åˆ° recipes è¡¨
  - âœ… Query analysis: ç¡®å®šæŸ¥è¯¢æ„å›¾
  - âœ… SQL generation: `SELECT COUNT(recipes.id) AS total_dishes FROM recipes`
  - âœ… SQL validation: éªŒè¯é€šè¿‡
  - âœ… SQL execution: æ‰§è¡ŒæˆåŠŸï¼Œè¿”å› 70 é“èœ
- **å›å¤æ‘˜è¦**:
  ```
  ### æŸ¥è¯¢ç»“æœæ‘˜è¦
  é—®é¢˜ï¼šæ•°æ®åº“ä¸­æ”¶å½•çš„èœå“æ€»æ•°æ˜¯å¤šå°‘ï¼Ÿ

  ## SQL å‘½ä»¤åˆ†ææŠ¥å‘Š
  æ¶‰åŠçš„è¡¨: recipes
  å…³é”®å­—æ®µ: id
  èšåˆéœ€æ±‚: COUNT(recipes.id) AS total_dishes

  ### ç»“æœé¢„è§ˆ
  total_dishes: 70
  ```
- **âœ… éªŒè¯ç‚¹**:
  - [x] è·¯ç”±ç±»å‹æ­£ç¡®ï¼ˆå¯å‘å¼å…³é”®è¯"å¤šå°‘"è§¦å‘ï¼‰
  - [x] ç”Ÿæˆçš„ SQL æ­£ç¡®
  - [x] æˆåŠŸæ‰§è¡Œå¹¶è¿”å›ç»“æœ
  - [x] å›å¤æ ¼å¼æ¸…æ™°ï¼ŒåŒ…å« SQL åˆ†æ

#### âœ… PASS - æ’åæŸ¥è¯¢
- **é—®é¢˜**: "å“ªä¸ªèœç³»çš„èœè°±æœ€å¤š"
- **é¢„æœŸè·¯ç”±**: text2sql-query
- **å®é™…è·¯ç”±**: text2sql-query âœ…
- **å“åº”æ—¶é—´**: 20.35s
- **Text2SQL å­æµç¨‹**:
  - âœ… Guardrails å‰ç½®è§„åˆ™å‘½ä¸­
  - âœ… Planner: "ç»Ÿè®¡å„èœç³»çš„èœè°±æ•°é‡ï¼Œæ‰¾å‡ºèœè°±æœ€å¤šçš„èœç³»"
  - âœ… Tool selection: Text2SQL
  - âœ… Schema retrieval: æˆåŠŸ
  - âœ… Query analysis: æ¶‰åŠ recipes è¡¨
  - âœ… SQL generation: æˆåŠŸ
  - âœ… SQL validation: é€šè¿‡
  - âš ï¸ SQL execution: **è¢«æ‹’ç»**ï¼ˆæ£€æµ‹åˆ°éåªè¯»æŸ¥è¯¢ï¼‰
- **å›å¤æ‘˜è¦**:
  ```
  ### æ•°æ®ç»Ÿè®¡
  ç»Ÿè®¡å„èœç³»çš„èœè°±æ•°é‡ï¼Œæ‰¾å‡ºèœè°±æœ€å¤šçš„èœç³»ï¼š
  æŠ±æ­‰ï¼Œæ‰§è¡Œ SQL æ—¶å‡ºç°é”™è¯¯ï¼šä»…æ”¯æŒåªè¯» SELECT æŸ¥è¯¢
  ```
- **é—®é¢˜åˆ†æ**:
  - LLM å¯èƒ½ç”Ÿæˆäº†åŒ…å« UPDATE/DELETE/INSERT çš„ SQLï¼ˆæˆ–è¢«è¯¯åˆ¤ï¼‰
  - SQL éªŒè¯é€šè¿‡ä½†æ‰§è¡Œæ—¶è¢«å®‰å…¨æ£€æŸ¥æ‹¦æˆª
- **âœ… éªŒè¯ç‚¹**:
  - [x] è·¯ç”±ç±»å‹æ­£ç¡®
  - [x] SQL ç”Ÿæˆå’ŒéªŒè¯æµç¨‹æ­£å¸¸
  - [x] å®‰å…¨æ£€æŸ¥æœºåˆ¶æœ‰æ•ˆï¼ˆé¿å…è¯¯æ‰§è¡Œå±é™© SQLï¼‰
- **æ”¹è¿›å»ºè®®**:
  - å¢å¼º SQL ç”Ÿæˆ promptï¼Œæ˜ç¡®è¦æ±‚åªç”Ÿæˆ SELECT
  - æˆ–è€…åœ¨éªŒè¯ç¯èŠ‚æ£€æŸ¥ SQL ç±»å‹

---

## ğŸ” å…³é”®å‘ç°

### âœ… å·¥ä½œè‰¯å¥½çš„éƒ¨åˆ†

1. **è·¯ç”±å‡†ç¡®æ€§é«˜ï¼ˆ70%ï¼‰**
   - General-query: 100% å‡†ç¡®
   - KB-query: 100% å‡†ç¡®
   - GraphRAG-query: 66.7% å‡†ç¡®ï¼ˆ2/3é€šè¿‡ï¼‰
   - Text2SQL-query: 100% å‡†ç¡®

2. **KB Multi-tool Router æ™ºèƒ½å†³ç­–æœ‰æ•ˆ**
   - æ­£ç¡®é€‰æ‹©äº† Milvus ä½œä¸ºå•ä¸€æ•°æ®æº
   - Guardrails æ£€æŸ¥æ­£å¸¸å·¥ä½œ

3. **GraphRAG Planner ä»»åŠ¡åˆ†è§£å‡†ç¡®**
   - æˆåŠŸå°†ç”¨æˆ·é—®é¢˜ç»†åŒ–ä¸ºå­ä»»åŠ¡
   - å‰ç½®è§„åˆ™å‘½ä¸­æœºåˆ¶é«˜æ•ˆ

4. **Text2SQL æµç¨‹å®Œæ•´**
   - Schema æ£€ç´¢ â†’ åˆ†æ â†’ ç”Ÿæˆ â†’ éªŒè¯ â†’ æ‰§è¡Œ â†’ æ ¼å¼åŒ–
   - å®‰å…¨æ£€æŸ¥æœ‰æ•ˆï¼ˆé˜²æ­¢å±é™© SQLï¼‰

5. **å›å¤è´¨é‡é«˜**
   - ç»“æ„æ¸…æ™°ï¼Œæ ¼å¼å‹å¥½
   - åŒ…å«æ¥æºä¿¡æ¯ï¼ˆMilvus æ£€ç´¢ç»“æœï¼‰
   - å³ä½¿çŸ¥è¯†åº“æ²¡æœ‰ä¿¡æ¯ï¼Œä¹Ÿèƒ½ç»“åˆå¸¸è¯†è¡¥å……

### âš ï¸ éœ€è¦ä¿®å¤çš„é—®é¢˜

1. **Additional-Query Guardrails è¿”å› None**
   - å½±å“èŒƒå›´: `additional-query` è·¯ç”±
   - é”™è¯¯ç‡: 1/2 (50%)
   - ä¼˜å…ˆçº§: **é«˜**
   - ä¿®å¤æ–¹æ¡ˆ: æ·»åŠ ç©ºå€¼æ£€æŸ¥å’Œé»˜è®¤å€¼

2. **GraphRAG Cypher éªŒè¯æ ¼å¼é”™è¯¯**
   - å½±å“èŒƒå›´: `graphrag-query` â†’ `cypher_query` å·¥å…·
   - é”™è¯¯ç‡: 1/3 (33%)
   - ä¼˜å…ˆçº§: **ä¸­**
   - ä¿®å¤æ–¹æ¡ˆ:
     - å¢å¼º Cypher ç”Ÿæˆ promptï¼Œæ˜ç¡®è¾“å‡ºæ ¼å¼
     - æ·»åŠ  fallback æœºåˆ¶ï¼ˆé™çº§åˆ° GraphRAGï¼‰

3. **Text2SQL å®‰å…¨æ£€æŸ¥è¯¯æ‹¦æˆª**
   - å½±å“èŒƒå›´: `text2sql-query`
   - é—®é¢˜: åˆæ³•çš„ SELECT æŸ¥è¯¢è¢«æ‹’ç»
   - ä¼˜å…ˆçº§: **ä¸­**
   - ä¿®å¤æ–¹æ¡ˆ: ä¼˜åŒ– SQL å®‰å…¨æ£€æŸ¥é€»è¾‘

### ğŸ¤” å€¼å¾—è®¨è®ºçš„è®¾è®¡é€‰æ‹©

1. **æ— å…³é—®é¢˜çš„è·¯ç”±è·¯å¾„**
   - å½“å‰: LLM ç›´æ¥è·¯ç”±åˆ° `general-query` å¹¶æ‹’ç»
   - é¢„æœŸ: è·¯ç”±åˆ° `additional-query` â†’ Guardrails æ‹¦æˆª
   - ç»“è®º: ä¸¤ç§æ–¹å¼éƒ½èƒ½è¾¾åˆ°æ•ˆæœï¼Œå½“å‰æ–¹å¼æ›´é«˜æ•ˆ

2. **KB Router åªé€‰æ‹©å•ä¸€æ•°æ®æº**
   - å½“å‰: ä¸¤ä¸ª kb-query æµ‹è¯•éƒ½åªé€‰æ‹©äº† `[milvus]`
   - æœŸæœ›: å¤æ‚é—®é¢˜åº”è§¦å‘ `[milvus, pgvector]` å¤šæºæ£€ç´¢
   - å¯èƒ½åŸå› : é—®é¢˜ä¸å¤Ÿå¤æ‚ï¼Œæˆ– Router prompt éœ€è¦è°ƒæ•´

---

## ğŸ“ˆ æ€§èƒ½åˆ†æ

| è·¯ç”±ç±»å‹ | å¹³å‡å“åº”æ—¶é—´ | æµ‹è¯•æ ·æœ¬ |
|---------|-------------|---------|
| general-query | 5.00s | 1 |
| kb-query | 32.27s | 2 |
| graphrag-query | 12.43s | 2 (æˆåŠŸçš„) |
| text2sql-query | 22.44s | 2 |

**æ€§èƒ½ç“¶é¢ˆ**:
- KB-query æœ€æ…¢ï¼ˆ32sï¼‰ï¼Œä¸»è¦è€—æ—¶åœ¨ Milvus æ£€ç´¢å’Œ LLM å›ç­”ç”Ÿæˆ
- Text2SQL æ¬¡æ…¢ï¼ˆ22sï¼‰ï¼Œè€—æ—¶åœ¨å¤šæ­¥éª¤æµç¨‹ï¼ˆSchema â†’ åˆ†æ â†’ ç”Ÿæˆ â†’ éªŒè¯ â†’ æ‰§è¡Œï¼‰
- GraphRAG æœ€å¿«ï¼ˆ12sï¼‰ï¼Œå¾—ç›Šäºå‰ç½®è§„åˆ™å¿«é€Ÿå‘½ä¸­

---

## ğŸ› ï¸ ä¼˜å…ˆä¿®å¤æ¸…å•

### 1. é«˜ä¼˜å…ˆçº§ï¼ˆå½±å“åŠŸèƒ½æ­£å¸¸è¿è¡Œï¼‰

```python
# ä¿®å¤1: Additional-Query Guardrails ç©ºå€¼å¤„ç†
# æ–‡ä»¶: gustobot/application/agents/lg_builder.py:311

guardrails_output: AdditionalGuardrailsOutput = await guardrails_chain.ainvoke(...)

# æ·»åŠ ç©ºå€¼æ£€æŸ¥
if guardrails_output is None:
    logger.warning("Guardrails returned None, defaulting to proceed")
    guardrails_output = AdditionalGuardrailsOutput(decision="proceed")

if guardrails_output.decision == "end":
    ...
```

### 2. ä¸­ä¼˜å…ˆçº§ï¼ˆæå‡ç¨³å®šæ€§ï¼‰

```python
# ä¿®å¤2: Cypher Query é”™è¯¯å¤„ç†å’Œé™çº§
# æ–‡ä»¶: kg_sub_graph/agentic_rag_agents/components/cypher_tools/node.py

try:
    validated_output = ValidateCypherOutput.model_validate(llm_response)
except ValidationError as e:
    logger.warning(f"Cypher validation failed: {e}")
    logger.info("Falling back to GraphRAG query")
    # è¿”å›ç‰¹æ®Šæ ‡è®°ï¼Œè®© tool_selection é‡æ–°é€‰æ‹© microsoft_graphrag_query
    return {"fallback_to_graphrag": True, "reason": str(e)}
```

```python
# ä¿®å¤3: Text2SQL å®‰å…¨æ£€æŸ¥ä¼˜åŒ–
# æ–‡ä»¶: kg_sub_graph/agentic_rag_agents/components/text2sql/sql_execution/node.py

def _is_readonly_query(sql: str) -> bool:
    """æ£€æŸ¥ SQL æ˜¯å¦ä¸ºåªè¯»æŸ¥è¯¢"""
    sql_upper = sql.strip().upper()
    # å…è®¸ SELECTã€WITHã€EXPLAIN
    readonly_keywords = ['SELECT', 'WITH', 'EXPLAIN']
    # æ‹’ç» INSERTã€UPDATEã€DELETEã€DROPã€CREATEã€ALTER
    dangerous_keywords = ['INSERT', 'UPDATE', 'DELETE', 'DROP', 'CREATE', 'ALTER', 'TRUNCATE']

    starts_with_readonly = any(sql_upper.startswith(kw) for kw in readonly_keywords)
    contains_dangerous = any(kw in sql_upper for kw in dangerous_keywords)

    return starts_with_readonly and not contains_dangerous
```

### 3. ä½ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–æ”¹è¿›ï¼‰

- è°ƒæ•´ KB Router promptï¼Œå¢åŠ è§¦å‘å¤šæºæ£€ç´¢çš„æ¦‚ç‡
- ä¼˜åŒ–å“åº”æ—¶é—´ï¼ˆè€ƒè™‘ç¼“å­˜ã€å¹¶è¡ŒåŒ–ï¼‰
- å¢åŠ æ›´å¤šè¾¹ç•Œæµ‹è¯•ç”¨ä¾‹

---

## ğŸ“ æµ‹è¯•æ•°æ®ä¿å­˜

æ‰€æœ‰æµ‹è¯•ç»“æœå·²ä¿å­˜åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š
- **JSON ç»“æœ**: `/data/temp32/GustoBot/test_results.json` (12KB)
- **å®Œæ•´æ—¥å¿—**: `/data/temp32/GustoBot/test_output.log` (33KB)
- **æµ‹è¯•æŠ¥å‘Š**: `/data/temp32/GustoBot/TEST_REPORT.md` (æœ¬æ–‡ä»¶)

---

## âœ… æ€»ç»“

æœ¬æ¬¡æµ‹è¯•éªŒè¯äº† GustoBot å¤š Agent ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸»è¦å‘ç°ï¼š

### ä¼˜ç‚¹:
1. âœ… è·¯ç”±å‡†ç¡®æ€§è¾¾åˆ° 70%ï¼Œæ ¸å¿ƒè·¯ç”±ç±»å‹ï¼ˆgeneralã€kbã€text2sqlï¼‰100% å‡†ç¡®
2. âœ… KB Multi-tool å’Œ GraphRAG Planner çš„æ™ºèƒ½å†³ç­–æœºåˆ¶æœ‰æ•ˆ
3. âœ… Text2SQL å…¨æµç¨‹å®Œæ•´ï¼Œå®‰å…¨æ£€æŸ¥æœ‰æ•ˆ
4. âœ… å›å¤è´¨é‡é«˜ï¼Œæ ¼å¼æ¸…æ™°ï¼ŒåŒ…å«æ¥æºä¿¡æ¯

### éœ€è¦æ”¹è¿›:
1. âŒ Additional-Query Guardrails å­˜åœ¨ç©ºå€¼è¿”å›é—®é¢˜ï¼ˆå½±å“ 50%ï¼‰
2. âŒ GraphRAG Cypher éªŒè¯å­˜åœ¨æ ¼å¼é”™è¯¯ï¼ˆå½±å“ 33%ï¼‰
3. âš ï¸ Text2SQL å®‰å…¨æ£€æŸ¥å¯èƒ½è¯¯æ‹¦æˆªåˆæ³•æŸ¥è¯¢

### ä¸‹ä¸€æ­¥:
1. ä¿®å¤ä¸Šè¿° 3 ä¸ªé—®é¢˜
2. å¢åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹ï¼ˆImage-Queryã€File-Queryã€å¤šè½®å¯¹è¯ï¼‰
3. ä¼˜åŒ–æ€§èƒ½ï¼ˆKB-query å’Œ Text2SQL å“åº”æ—¶é—´åé•¿ï¼‰
4. è§¦å‘ KB Multi-tool å¤šæºæ£€ç´¢çš„æµ‹è¯•

**æ•´ä½“è¯„ä»·**: ç³»ç»ŸåŸºç¡€åŠŸèƒ½å®Œå–„ï¼Œè·¯ç”±å†³ç­–å‡†ç¡®ï¼Œä½†åœ¨è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯å¤„ç†ä¸Šéœ€è¦åŠ å¼ºã€‚
